<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VERSUS REVISE - みおちゃん専用</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .setting-bar { transition: width 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
        input[type="password"] { font-size: 16px; }
    </style>
</head>
<body class="p-4 flex flex-col min-h-screen">

    <header class="text-center mb-6">
        <h1 class="text-3xl font-black italic tracking-tighter text-blue-500">VERSUS <span class="text-white">REVISE</span></h1>
        <p class="text-red-500 font-bold text-[10px] mt-1 tracking-[0.3em]">みおちゃん専用 VER 1.6.0 <span class="text-gray-500 font-normal italic">STATISTICAL BATTLE</span></p>
    </header>

    <div id="drop-zone" class="border-2 border-dashed border-blue-500/20 rounded-3xl p-8 text-center bg-blue-900/5 mb-6 active:bg-blue-900/10 transition-all">
        <p class="text-sm font-bold text-gray-400">ユニメモ画像を解析</p>
        <p class="text-[9px] text-blue-500 mt-2 uppercase tracking-widest italic font-black">Waiting for Data...</p>
        <input type="file" id="file-input" multiple class="hidden" accept="image/*">
    </div>

    <main class="flex-grow bg-slate-900/90 rounded-[2.5rem] p-8 border border-white/5 shadow-2xl mb-6 shadow-blue-500/5">
        <div id="status-text" class="text-right text-[9px] text-blue-400 font-mono mb-8 tracking-[0.2em] uppercase opacity-50 italic">Ready to Analyze</div>
        
        <div class="space-y-9">
            <div class="space-y-6 opacity-90">
                <div>
                    <div class="flex justify-between text-[10px] mb-2.5 px-1"><span class="font-black text-gray-500 tracking-widest">SETTING 1</span><span id="p1" class="font-mono text-gray-400">25.0%</span></div>
                    <div class="w-full bg-slate-800/50 h-2 rounded-full overflow-hidden">
                        <div id="bar1" class="setting-bar h-full bg-gray-600 shadow-[0_0_15px_rgba(107,114,128,0.3)]" style="width: 25%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-[10px] mb-2.5 px-1"><span class="font-black text-blue-500 tracking-widest uppercase">Setting 2</span><span id="p2" class="font-mono text-blue-400">25.0%</span></div>
                    <div class="w-full bg-slate-800/50 h-2 rounded-full overflow-hidden">
                        <div id="bar2" class="setting-bar h-full bg-blue-500 shadow-[0_0_15px_rgba(59,130,246,0.4)]" style="width: 25%"></div>
                    </div>
                </div>
            </div>

            <div class="border-t border-white/5 my-2"></div>

            <div class="space-y-6">
                <div>
                    <div class="flex justify-between text-[10px] mb-2.5 px-1"><span class="font-black text-orange-500 tracking-widest uppercase">Setting 5</span><span id="p5" class="font-mono text-orange-400">25.0%</span></div>
                    <div class="w-full bg-slate-800/50 h-2 rounded-full overflow-hidden">
                        <div id="bar5" class="setting-bar h-full bg-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.4)]" style="width: 25%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-[10px] mb-2.5 px-1"><span class="font-black text-red-600 tracking-widest uppercase text-shadow-glow">Setting 6</span><span id="p6" class="font-mono text-red-500">25.0%</span></div>
                    <div class="w-full bg-slate-800/50 h-2 rounded-full overflow-hidden">
                        <div id="bar6" class="setting-bar h-full bg-red-600 shadow-[0_0_20px_rgba(220,38,38,0.5)]" style="width: 25%"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-auto pb-4 space-y-3">
        <div class="flex gap-3 h-11">
            <input type="password" id="api-key" placeholder="Vision API Key" class="flex-grow bg-slate-800 border border-white/10 rounded-2xl px-5 text-xs text-white focus:outline-none focus:border-blue-500 transition-all shadow-inner">
            <button id="save-key" class="bg-blue-600 px-8 rounded-2xl text-[10px] font-black tracking-widest active:scale-95 transition-transform uppercase shadow-lg shadow-blue-500/20">Set</button>
        </div>
        <p id="key-status" class="text-[8px] text-center text-gray-600 font-bold uppercase tracking-[0.4em] italic">Awaiting API Activation</p>
    </footer>

    <script>
        // 設定3, 4は論外として除外済
        const TARGETS = {
            bellA: [10.5, 10.1, 9.8, 9.4], // 1, 2, 5, 6
            rb: [409.6, 397.2, 350.5, 312.1], //
            vgH: [11.3, 10.4, 9.5, 8.2] //
        };

        function calculateReliability(trials) {
            // 信頼度の動的計算（5,800Gでまとも、10,100Gで確信）
            if (trials < 300) return 0.15;
            if (trials < 1000) return 0.4;
            if (trials < 3000) return 0.7;
            if (trials < 5800) return 0.9;
            return 1.0;
        }

        function analyze(data) {
            let scores = { 1: 1.0, 2: 1.0, 5: 1.0, 6: 1.0 };
            const rel = calculateReliability(data.totalGames);

            // 確率計算（信頼度による重み付けを適用）
            [1, 2, 5, 6].forEach((set, i) => {
                const bExp = data.totalGames / TARGETS.bellA[i];
                const bScore = Math.exp(-Math.pow(data.bellACount - bExp, 2) / (2 * bExp));
                scores[set] *= (1 - rel) + (bScore * rel); // 試行が少ないほど1.0に近づく

                const rExp = data.totalGames / TARGETS.rb[i];
                const rScore = Math.exp(-Math.pow(data.rbCount - rExp, 2) / (2 * rExp));
                scores[set] *= (1 - rel) + (rScore * rel);
            });

            // 【鉄の掟：ユニメモ項目】
            // RBハズレ：1・2を即死させる
            if (data.rbHazure > 0) { scores[1] = 0; scores[2] = 0; }
            
            // BBチェリー+ベルはずれ：偶奇判別（設定2・6重視）
            if (data.bbCherryBellHazure > 0) {
                const count = data.bbCherryBellHazure;
                scores[1] *= Math.pow(1/81.9, count);
                scores[5] *= Math.pow(1/81.9, count);
                scores[2] *= Math.pow(1/41.0, count);
                scores[6] *= Math.pow(1/41.0, count);
            }

            // 正規化
            const total = Object.values(scores).reduce((a, b) => a + b) || 1;
            return {
                1: (scores[1]/total*100).toFixed(1),
                2: (scores[2]/total*100).toFixed(1),
                5: (scores[5]/total*100).toFixed(1),
                6: (scores[6]/total*100).toFixed(1)
            };
        }

        // UI Event Listeners
        document.getElementById('save-key').onclick = () => {
            localStorage.setItem('v_key', document.getElementById('api-key').value);
            document.getElementById('key-status').innerText = 'System Active';
            document.getElementById('key-status').style.color = '#3b82f6';
        };
        document.getElementById('drop-zone').onclick = () => document.getElementById('file-input').click();
    </script>
</body>
</html>