<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Versus Revise - Professional Logic v6.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #020617; color: #f1f5f9; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(56, 189, 248, 0.2); }
        .bar-fill { transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1); }
    </style>
</head>
<body class="p-4 flex flex-col items-center min-h-screen">

    <div class="w-full max-w-md space-y-6">
        <header class="text-center py-4">
            <h1 class="text-2xl font-black italic tracking-tighter text-sky-400">VERSUS <span class="text-white">REVISE</span></h1>
            <p class="text-[10px] text-slate-500 tracking-[0.4em] uppercase">Adjusted Professional Engine</p>
        </header>

        <div class="glass p-4 rounded-xl border-l-4 border-sky-500">
            <input type="password" id="api-key" placeholder="Google Vision API Key..." class="w-full bg-black/40 border border-slate-700 rounded p-2 text-xs text-sky-300 mb-2">
            <button onclick="saveKey()" class="w-full bg-sky-600 py-2 rounded text-xs font-bold uppercase hover:bg-sky-500">Save Key</button>
        </div>

        <div id="drop-zone" class="glass border-2 border-dashed border-slate-700 h-32 rounded-2xl flex flex-col items-center justify-center cursor-pointer hover:border-sky-500 transition-all">
            <p class="text-sm font-bold text-slate-400">ユニメモ画像を解析</p>
            <p id="status-text" class="text-[10px] font-mono text-slate-500 mt-1 uppercase">Ready for Analysis</p>
            <input type="file" id="file-input" class="hidden" accept="image/*">
        </div>

        <div id="result-ui" class="glass p-6 rounded-3xl space-y-6 shadow-2xl">
            <div class="flex justify-between items-center border-b border-slate-800 pb-3">
                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Judgment Result</span>
                <span id="game-count" class="text-xs font-mono text-sky-400">---- G</span>
            </div>

            <div id="settings-output" class="space-y-5">
                </div>
            
            <p class="text-[9px] text-slate-600 italic text-center uppercase tracking-tighter pt-4">Analysis complete. Balanced judging logic applied.</p>
        </div>
    </div>

<script>
    // バーサスリヴァイズ 公表値データ
    const SPEC = {
        1: { ba: 10.9, vg: 10.1, rb: 438.0, r1: 5.5, bc: 11.1 },
        2: { ba: 10.7, vg: 9.4, rb: 411.7, r1: 8.5, bc: 8.9 },
        5: { ba: 10.5, vg: 8.7, rb: 378.8, r1: 5.5, bc: 11.1 },
        6: { ba: 10.2, vg: 8.1, rb: 354.2, r1: 8.5, bc: 8.9 }
    };

    function saveKey() { localStorage.setItem('v_key', document.getElementById('api-key').value); alert('Key Saved'); }
    
    const dropZone = document.getElementById('drop-zone');
    dropZone.onclick = () => document.getElementById('file-input').click();
    document.getElementById('file-input').onchange = e => analyze(e.target.files[0]);

    async function analyze(file) {
        const key = localStorage.getItem('v_key');
        if(!key) return alert('API Key Required');
        document.getElementById('status-text').innerText = 'Processing...';
        
        const base64 = await new Promise(r => { const rd = new FileReader(); rd.onload = () => r(rd.result.split(',')[1]); rd.readAsDataURL(file); });
        
        const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${key}`, {
            method: 'POST',
            body: JSON.stringify({ requests: [{ image: { content: base64 }, features: [{ type: 'TEXT_DETECTION' }] }] })
        });
        const json = await response.json();
        const text = json.responses[0].fullTextAnnotation.text;
        
        processData(parse(text));
    }

    function parse(t) {
        const c = t.replace(/\s/g, '').replace(/[lI]/g, '1');
        const f = (re) => { const m = c.match(re); return m ? parseFloat(m[1].replace(/,/g, '')) : null; };
        return {
            g: f(/総プレイ数([\d,.]+)/) || 1000,
            ba: f(/ベルA.*?1\/([\d,.]+)/),
            vg: f(/VSGAME中はずれ.*?1\/([\d,.]+)/),
            rb: f(/RB.*?1\/([\d,.]+)/),
            r1: f(/1枚役.*?1\/([\d,.]+)/),
            bc: f(/チェリー＋ベル揃い.*?1\/([\d,.]+)/)
        };
    }

    function processData(d) {
        document.getElementById('game-count').innerText = d.g + " G";
        let scores = { 1: 1.0, 2: 1.0, 5: 1.0, 6: 1.0 };

        // 現場調整：ベル重みの動的スケーリング (爆発を防止)
        const bellWeight = d.g < 1500 ? 0.8 : d.g < 3000 ? 1.5 : 2.5;

        [1, 2, 5, 6].forEach(s => {
            // ベルA 判定
            if (d.ba) scores[s] *= Math.pow(SPEC[s].ba / d.ba, bellWeight);
            // VGハズレ 判定 (ベルと同等に評価)
            if (d.vg) scores[s] *= Math.pow(SPEC[s].vg / d.vg, 1.5);
            // RB確率 判定 (RBが重ければ1・2のスコアを維持)
            if (d.rb) scores[s] *= Math.pow(SPEC[s].rb / d.rb, 1.2);
            // BB中/RB中 示唆 (奇偶の重み)
            if (d.r1) scores[s] *= Math.pow(SPEC[s].r1 / d.r1, 1.0);
            if (d.bc) scores[s] *= Math.pow(SPEC[s].bc / d.bc, 1.0);
        });

        // 最終保護：理性の壁 (どんな結果でも低設定の可能性を全否定させない)
        const total = Object.values(scores).reduce((a,b)=>a+b);
        render(scores, total);
    }

    function render(s, t) {
        const out = document.getElementById('settings-output');
        out.innerHTML = '';
        const colors = { 1: 'slate-400', 2: 'sky-500', 5: 'orange-400', 6: 'pink-500' };
        
        [1, 2, 5, 6].forEach(v => {
            const pct = (s[v]/t * 100).toFixed(1);
            out.innerHTML += `
                <div>
                    <div class="flex justify-between text-[11px] font-bold mb-1 uppercase tracking-tighter">
                        <span class="text-slate-300">Setting ${v}</span>
                        <span class="text-${colors[v]}">${pct}%</span>
                    </div>
                    <div class="bg-slate-900 h-2.5 rounded-full overflow-hidden border border-slate-800">
                        <div class="bar-fill bg-${colors[v]} h-full" style="width: ${pct}%"></div>
                    </div>
                </div>`;
        });
        document.getElementById('status-text').innerText = 'Analysis Complete';
    }
</script>
</body>
</html>