<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Versus Revise Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .bar-bg { background: #334155; height: 12px; border-radius: 6px; overflow: hidden; }
        .bar-fill { background: linear-gradient(90deg, #38bdf8, #818cf8); height: 100%; transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); width: 0%; }
    </style>
</head>
<body class="flex flex-col items-center p-4 min-h-screen">

    <header class="w-full max-w-md mb-8 text-center">
        <h1 class="text-2xl font-bold tracking-tight text-sky-400">VERSUS REVISE</h1>
        <p class="text-xs text-slate-400 font-mono">BAYESIAN ESTIMATION ENGINE v1.0</p>
    </header>

    <main class="w-full max-w-md glass rounded-3xl p-6 shadow-2xl">
        <div class="mb-8 text-center">
            <label for="file-upload" class="cursor-pointer flex flex-col items-center justify-center p-8 border-2 border-dashed border-slate-600 rounded-2xl hover:border-sky-500 transition-all bg-slate-800/30">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-slate-400 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span id="file-name" class="text-sm font-medium">ユニメモ画像を添付</span>
                <input id="file-upload" type="file" class="hidden" accept="image/*">
            </label>
        </div>

        <div id="results-container" class="space-y-6">
            <div id="row-1">
                <div class="flex justify-between text-sm font-bold mb-2">
                    <span>設定 1</span><span id="val-1" class="text-sky-400">-- %</span>
                </div>
                <div class="bar-bg"><div id="bar-1" class="bar-fill"></div></div>
            </div>
            <div id="row-2">
                <div class="flex justify-between text-sm font-bold mb-2">
                    <span>設定 2</span><span id="val-2" class="text-sky-400">-- %</span>
                </div>
                <div class="bar-bg"><div id="bar-2" class="bar-fill"></div></div>
            </div>
            <div id="row-5">
                <div class="flex justify-between text-sm font-bold mb-2">
                    <span>設定 5</span><span id="val-5" class="text-sky-400">-- %</span>
                </div>
                <div class="bar-bg"><div id="bar-5" class="bar-fill"></div></div>
            </div>
            <div id="row-6">
                <div class="flex justify-between text-sm font-bold mb-2">
                    <span>設定 6</span><span id="val-6" class="text-sky-400">-- %</span>
                </div>
                <div class="bar-bg"><div id="bar-6" class="bar-fill"></div></div>
            </div>
        </div>

        <button onclick="runAnalysis()" class="w-full mt-8 py-4 bg-sky-600 hover:bg-sky-500 rounded-xl font-bold transition-all active:scale-95 shadow-lg shadow-sky-900/40">
            判別実行
        </button>
    </main>

    <script>
        // マスターデータ
        const MASTER = {
            bonus: { 1: {t:194.7, b:350.4, r:438}, 2: {t:184.2, b:334.3, r:411.7}, 5: {t:173.3, b:318.1, r:378.8}, 6: {t:161.8, b:297.8, r:354.2} },
            normal: { 1: {bt:7.2, ba:10.9, bb:20.9, sa:74.5, ca:119.2, cb:56.2}, 2: {bt:7.1, ba:10.7, bb:21.2, sa:70.6, ca:118.9, cb:57.7}, 5: {bt:6.9, ba:10.5, bb:20.3, sa:72.5, ca:118.9, cb:53.1}, 6: {bt:6.8, ba:10.2, bb:20.6, sa:68.8, ca:118.9, cb:54.4} },
            rt: { 1: {vc:5.0, vg:10.1}, 2: {vc:4.9, vg:9.4}, 5: {vc:4.6, vg:8.7}, 6: {vc:4.5, vg:8.1} },
            bb: { 1: {bl:1.10, cbs:11.1, cbh:256, mc:16384}, 2: {bl:1.14, cbs:8.9, cbh:128, mc:16384}, 5: {bl:1.10, cbs:11.1, cbh:256, mc:16384}, 6: {bl:1.14, cbs:8.9, cbh:128, mc:897.8} },
            rb: { 1: {h:1000000}, 2: {h:1000000}, 5: {h:376.6}, 6: {h:376.6} }
        };

        function runAnalysis() {
            // モック用のダミー入力（本来はOCRで抽出する数値）
            const dummyInput = {
                bonus: {t:170.2, b:300.5, r:390},
                normal: {bt:6.9, ba:10.4, bb:20.8, sa:70.2, ca:119.0, cb:54.0},
                rt: {vc:4.6, vg:8.5},
                bb: {bl:1.14, cbs:9.0, cbh:130.5, mc:16384},
                rb: {h:1000000} // ハズレなし
            };

            let probs = { 1: 0.25, 2: 0.25, 5: 0.25, 6: 0.25 };
            const settings = [1, 2, 5, 6];

            Object.keys(MASTER).forEach(cat => {
                Object.keys(MASTER[cat][1]).forEach(key => {
                    let obs = dummyInput[cat][key];
                    settings.forEach(s => {
                        let m = MASTER[cat][s][key];
                        // 尤度計算：差の絶対値に基づく簡易ベイズ
                        let likelihood = Math.exp(-Math.pow((1/obs - 1/m), 2) / 0.0005);
                        probs[s] *= likelihood;
                    });
                });
                normalize(probs);
            });

            updateUI(probs);
        }

        function normalize(p) {
            let sum = Object.values(p).reduce((a, b) => a + b, 0);
            Object.keys(p).forEach(k => p[k] /= sum);
        }

        function updateUI(p) {
            [1, 2, 5, 6].forEach(s => {
                const percent = Math.round(p[s] * 100);
                document.getElementById(`val-${s}`).innerText = `${percent} %`;
                document.getElementById(`bar-${s}`).style.width = `${percent}%`;
            });
        }

        document.getElementById('file-upload').onchange = e => {
            document.getElementById('file-name').innerText = e.target.files[0].name;
            runAnalysis();
        };
    </script>
</body>
</html>